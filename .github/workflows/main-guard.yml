name: Main Guard

on:
  push:
    branches: [main]

permissions:
  contents: read
  pull-requests: read

jobs:
  deny-direct-push:
    runs-on: ubuntu-latest

    steps:
      - name: Check commit is from PR
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo } = context.repo;
            const commitSha = context.sha;

            const result = await github.rest.repos.listPullRequestsAssociatedWithCommit({
              owner,
              repo,
              commit_sha: commitSha,
            });

            if (!result.data || result.data.length === 0) {
              core.setFailed('Direct push to main is not allowed. Please use a Pull Request.');
            }
